<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/public/demo.html">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/public/demo.html" />
              <option name="originalContent" value="&lt;!DOCTYPE html&gt;&#10;&lt;html lang=&quot;en&quot;&gt;&#10;&#10;&lt;head&gt;&#10;   &lt;title&gt;Demo PASTA Search&lt;/title&gt;&#10;   &lt;meta charset=&quot;utf-8&quot; /&gt;&#10;   &lt;link rel=&quot;stylesheet&quot; href=&quot;https://use.fontawesome.com/releases/v5.3.1/css/all.css&quot; integrity=&quot;sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU&quot;&#10;      crossorigin=&quot;anonymous&quot;&gt;&#10;   &lt;link href=&quot;search.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&#10;   &lt;link href=&quot;auto-complete.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&#10;   &lt;script src=&quot;cors.js&quot;&gt;&lt;/script&gt;&#10;   &lt;script src=&quot;pagination.js&quot;&gt;&lt;/script&gt;&#10;   &lt;script src=&quot;auto-complete.min.js&quot;&gt;&lt;/script&gt;&#10;   &lt;script src=&quot;ucsv-1.2.0.min.js&quot;&gt;&lt;/script&gt;&#10;   &lt;script src=&quot;pasta_lookup.js&quot;&gt;&lt;/script&gt;&#10;   &lt;script src=&quot;pasta.js&quot;&gt;&lt;/script&gt;&#10;&lt;/head&gt;&#10;&#10;&lt;body&gt;&#10;   &lt;form id=&quot;dataSearchForm&quot; name=&quot;dataSearchForm&quot;&gt;&#10;      &lt;input type=&quot;hidden&quot; id=&quot;sort&quot; name=&quot;sort&quot; value=&quot;score&quot;&gt;&#10;      &lt;input class=&quot;search-input&quot; name=&quot;q&quot; placeholder=&quot;Enter search term&quot; type=&quot;text&quot;&gt;&#10;      &lt;input type=&quot;submit&quot; value=&quot;Search&quot;&gt;&#10;      &lt;!-- Only new faceted search fields remain --&gt;&#10;      &lt;div id=&quot;advancedInputs&quot; style=&quot;margin-top: 10px&quot;&gt;&#10;         &lt;div class=&quot;input-block&quot; style=&quot;display: flex; flex-direction: column; align-items: stretch; position: relative;&quot;&gt;&#10;            &lt;div style=&quot;display: flex; justify-content: space-between; align-items: center;&quot;&gt;&#10;              &lt;span&gt;&lt;i class=&quot;fas fa-tag&quot;&gt;&lt;/i&gt;&lt;label class=&quot;group-label&quot; for=&quot;keyword&quot;&gt;Keyword&lt;/label&gt;&lt;/span&gt;&#10;              &lt;button type=&quot;button&quot; id=&quot;keyword-toggle-btn&quot; aria-label=&quot;Toggle keyword dropdown&quot; style=&quot;background:none;border:none;cursor:pointer;font-size:1.2em;outline:none;padding:0 4px;&quot;&gt;&#10;                &lt;span id=&quot;keyword-arrow&quot;&gt;&amp;#x25BC;&lt;/span&gt;&#10;              &lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;keyword-dropdown&quot; id=&quot;keyword-dropdown&quot; style=&quot;display:none; position:absolute; right:0; top:100%; min-width:250px; max-width:400px; width:100%; z-index:20; background:#fff; border:1px solid #ccc; box-shadow:0 2px 8px rgba(0,0,0,0.18); padding:8px 0; max-height:220px; overflow-y:auto;&quot;&gt;&lt;/div&gt;&#10;         &lt;/div&gt;&#10;         &lt;div class=&quot;input-block&quot; style=&quot;display: flex; flex-direction: column; align-items: stretch; position: relative;&quot;&gt;&#10;            &lt;div style=&quot;display: flex; justify-content: space-between; align-items: center;&quot;&gt;&#10;              &lt;span&gt;&lt;i class=&quot;fas fa-user&quot;&gt;&lt;/i&gt;&lt;label class=&quot;group-label&quot; for=&quot;creator&quot;&gt;Creator&lt;/label&gt;&lt;/span&gt;&#10;              &lt;button type=&quot;button&quot; id=&quot;creator-toggle-btn&quot; aria-label=&quot;Toggle creator dropdown&quot; style=&quot;background:none;border:none;cursor:pointer;font-size:1.2em;outline:none;padding:0 4px;&quot;&gt;&#10;                &lt;span id=&quot;creator-arrow&quot;&gt;&amp;#x25BC;&lt;/span&gt;&#10;              &lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;creator-dropdown&quot; id=&quot;creator-dropdown&quot; style=&quot;display:none; position:absolute; right:0; top:100%; min-width:250px; max-width:400px; width:100%; z-index:20; background:#fff; border:1px solid #ccc; box-shadow:0 2px 8px rgba(0,0,0,0.18); padding:8px 0; max-height:220px; overflow-y:auto;&quot;&gt;&lt;/div&gt;&#10;         &lt;/div&gt;&#10;      &lt;/div&gt;&#10;   &lt;/form&gt;&#10;&#10;   &lt;div class=&quot;loading&quot; id=&quot;loading-div&quot;&gt;&#10;      &lt;i class=&quot;fas fa-spinner fa-pulse fa-3x fa-fw&quot;&gt;&lt;/i&gt;&#10;      &lt;span class=&quot;sr-only&quot;&gt;Loading...&lt;/span&gt;&#10;   &lt;/div&gt;&#10;   &lt;!-- &lt;p&gt;Search URL will be written below:&lt;/p&gt; --&gt;&#10;   &lt;!-- &lt;p id=&quot;searchUrl&quot;&gt;&lt;/p&gt; --&gt;&#10;   &lt;!-- &lt;p&gt;Search results will be written below:&lt;/p&gt; --&gt;&#10;   &lt;div class=&quot;resultCount&quot; id=&quot;resultCount&quot;&gt;&lt;/div&gt;&#10;   &lt;!-- &lt;div id=&quot;csvDownload&quot;&gt;&lt;/div&gt; --&gt;&#10;   &lt;div class=&quot;pagination&quot; id=&quot;paginationTop&quot;&gt;&lt;/div&gt;&#10;   &lt;div style=&quot;display:none&quot; id=&quot;sortDiv&quot;&gt;&#10;      &lt;label for=&quot;visibleSort&quot;&gt;Sort by&lt;/label&gt;&#10;      &lt;select name=&quot;sort&quot; id=&quot;visibleSort&quot;&gt;&#10;         &lt;option value=&quot;score&quot;&gt;Relevance&lt;/option&gt;&#10;         &lt;option value=&quot;pubdate&quot;&gt;Most recently published&lt;/option&gt;&#10;         &lt;option value=&quot;enddate&quot;&gt;Most recent data&lt;/option&gt;&#10;         &lt;option value=&quot;titles&quot;&gt;Title (a-z)&lt;/option&gt;&#10;         &lt;option value=&quot;responsibleParties&quot;&gt;Creator (a-z)&lt;/option&gt;&#10;      &lt;/select&gt;&#10;   &lt;/div&gt;&#10;   &lt;div id=&quot;searchResults&quot;&gt;&lt;/div&gt;&#10;   &lt;div class=&quot;pagination&quot; id=&quot;paginationBot&quot;&gt;&lt;/div&gt;&#10;&lt;/body&gt;&#10;&#10;&lt;/html&gt;&#10;" />
              <option name="updatedContent" value="&lt;!DOCTYPE html&gt;&#10;&lt;html lang=&quot;en&quot;&gt;&#10;&#10;&lt;head&gt;&#10;   &lt;title&gt;Demo PASTA Search&lt;/title&gt;&#10;   &lt;meta charset=&quot;utf-8&quot; /&gt;&#10;   &lt;link rel=&quot;stylesheet&quot; href=&quot;https://use.fontawesome.com/releases/v5.3.1/css/all.css&quot; integrity=&quot;sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU&quot;&#10;      crossorigin=&quot;anonymous&quot;&gt;&#10;   &lt;link href=&quot;search.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&#10;   &lt;link href=&quot;auto-complete.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;&#10;   &lt;script src=&quot;cors.js&quot;&gt;&lt;/script&gt;&#10;   &lt;script src=&quot;pagination.js&quot;&gt;&lt;/script&gt;&#10;   &lt;script src=&quot;auto-complete.min.js&quot;&gt;&lt;/script&gt;&#10;   &lt;script src=&quot;ucsv-1.2.0.min.js&quot;&gt;&lt;/script&gt;&#10;   &lt;script src=&quot;pasta_lookup.js&quot;&gt;&lt;/script&gt;&#10;   &lt;script src=&quot;pasta.js&quot;&gt;&lt;/script&gt;&#10;&lt;/head&gt;&#10;&#10;&lt;body&gt;&#10;   &lt;form id=&quot;dataSearchForm&quot; name=&quot;dataSearchForm&quot;&gt;&#10;      &lt;input type=&quot;hidden&quot; id=&quot;sort&quot; name=&quot;sort&quot; value=&quot;score&quot;&gt;&#10;      &lt;input class=&quot;search-input&quot; name=&quot;q&quot; placeholder=&quot;Enter search term&quot; type=&quot;text&quot;&gt;&#10;      &lt;input type=&quot;submit&quot; value=&quot;Search&quot;&gt;&#10;      &lt;!-- Only new faceted search fields remain --&gt;&#10;      &lt;div id=&quot;active-filters&quot;&gt;&lt;/div&gt;&#10;      &lt;div id=&quot;advancedInputs&quot; style=&quot;margin-top: 10px&quot;&gt;&#10;         &lt;div class=&quot;input-block&quot; style=&quot;display: flex; flex-direction: column; align-items: stretch; position: relative;&quot;&gt;&#10;            &lt;div style=&quot;display: flex; justify-content: space-between; align-items: center;&quot;&gt;&#10;              &lt;span&gt;&lt;i class=&quot;fas fa-tag&quot;&gt;&lt;/i&gt;&lt;label class=&quot;group-label&quot; for=&quot;keyword&quot;&gt;Keyword&lt;/label&gt;&lt;/span&gt;&#10;              &lt;button type=&quot;button&quot; id=&quot;keyword-toggle-btn&quot; aria-label=&quot;Toggle keyword dropdown&quot; style=&quot;background:none;border:none;cursor:pointer;font-size:1.2em;outline:none;padding:0 4px;&quot;&gt;&#10;                &lt;span id=&quot;keyword-arrow&quot;&gt;&amp;#x25BC;&lt;/span&gt;&#10;              &lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;keyword-dropdown&quot; id=&quot;keyword-dropdown&quot; style=&quot;display:none; position:absolute; right:0; top:100%; min-width:250px; max-width:400px; width:100%; z-index:20; background:#fff; border:1px solid #ccc; box-shadow:0 2px 8px rgba(0,0,0,0.18); padding:8px 0; max-height:220px; overflow-y:auto;&quot;&gt;&lt;/div&gt;&#10;         &lt;/div&gt;&#10;         &lt;div class=&quot;input-block&quot; style=&quot;display: flex; flex-direction: column; align-items: stretch; position: relative;&quot;&gt;&#10;            &lt;div style=&quot;display: flex; justify-content: space-between; align-items: center;&quot;&gt;&#10;              &lt;span&gt;&lt;i class=&quot;fas fa-user&quot;&gt;&lt;/i&gt;&lt;label class=&quot;group-label&quot; for=&quot;creator&quot;&gt;Creator&lt;/label&gt;&lt;/span&gt;&#10;              &lt;button type=&quot;button&quot; id=&quot;creator-toggle-btn&quot; aria-label=&quot;Toggle creator dropdown&quot; style=&quot;background:none;border:none;cursor:pointer;font-size:1.2em;outline:none;padding:0 4px;&quot;&gt;&#10;                &lt;span id=&quot;creator-arrow&quot;&gt;&amp;#x25BC;&lt;/span&gt;&#10;              &lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;creator-dropdown&quot; id=&quot;creator-dropdown&quot; style=&quot;display:none; position:absolute; right:0; top:100%; min-width:250px; max-width:400px; width:100%; z-index:20; background:#fff; border:1px solid #ccc; box-shadow:0 2px 8px rgba(0,0,0,0.18); padding:8px 0; max-height:220px; overflow-y:auto;&quot;&gt;&lt;/div&gt;&#10;         &lt;/div&gt;&#10;      &lt;/div&gt;&#10;   &lt;/form&gt;&#10;&#10;   &lt;div class=&quot;loading&quot; id=&quot;loading-div&quot;&gt;&#10;      &lt;i class=&quot;fas fa-spinner fa-pulse fa-3x fa-fw&quot;&gt;&lt;/i&gt;&#10;      &lt;span class=&quot;sr-only&quot;&gt;Loading...&lt;/span&gt;&#10;   &lt;/div&gt;&#10;   &lt;!-- &lt;p&gt;Search URL will be written below:&lt;/p&gt; --&gt;&#10;   &lt;!-- &lt;p id=&quot;searchUrl&quot;&gt;&lt;/p&gt; --&gt;&#10;   &lt;!-- &lt;p&gt;Search results will be written below:&lt;/p&gt; --&gt;&#10;   &lt;div class=&quot;resultCount&quot; id=&quot;resultCount&quot;&gt;&lt;/div&gt;&#10;   &lt;!-- &lt;div id=&quot;csvDownload&quot;&gt;&lt;/div&gt; --&gt;&#10;   &lt;div class=&quot;pagination&quot; id=&quot;paginationTop&quot;&gt;&lt;/div&gt;&#10;   &lt;div style=&quot;display:none&quot; id=&quot;sortDiv&quot;&gt;&#10;      &lt;label for=&quot;visibleSort&quot;&gt;Sort by&lt;/label&gt;&#10;      &lt;select name=&quot;sort&quot; id=&quot;visibleSort&quot;&gt;&#10;         &lt;option value=&quot;score&quot;&gt;Relevance&lt;/option&gt;&#10;         &lt;option value=&quot;pubdate&quot;&gt;Most recently published&lt;/option&gt;&#10;         &lt;option value=&quot;enddate&quot;&gt;Most recent data&lt;/option&gt;&#10;         &lt;option value=&quot;titles&quot;&gt;Title (a-z)&lt;/option&gt;&#10;         &lt;option value=&quot;responsibleParties&quot;&gt;Creator (a-z)&lt;/option&gt;&#10;      &lt;/select&gt;&#10;   &lt;/div&gt;&#10;   &lt;div id=&quot;searchResults&quot;&gt;&lt;/div&gt;&#10;   &lt;div class=&quot;pagination&quot; id=&quot;paginationBot&quot;&gt;&lt;/div&gt;&#10;&lt;/body&gt;&#10;&#10;&lt;/html&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/public/pasta.js">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/public/pasta.js" />
              <option name="originalContent" value="// Requires cors.js and pagination.js to be loaded first&#10;&#10;&quot;use strict&quot;;&#10;&#10;var PASTA_CONFIG = {&#10;   &quot;server&quot;: &quot;https://pasta.lternet.edu/package/search/eml?&quot;, // PASTA server&#10;   &quot;filter&quot;: '&amp;fq=keyword:&quot;Archbold Biological Station&quot;', // Filter results on a unique keyword of a research group&#10;   &quot;limit&quot;: 20, // Max number of results to retrieve per page&#10;   &quot;resultsElementId&quot;: &quot;searchResults&quot;, // Element to contain results&#10;   &quot;urlElementId&quot;: &quot;searchUrl&quot;, // Element to display search URL. Use &quot;searchUrl&quot; to display or &quot;&quot; to remove FIXME: Empty string does not turn off.&#10;   &quot;countElementId&quot;: &quot;resultCount&quot;, // Element showing number of results&#10;   &quot;csvElementId&quot;: &quot;csvDownload&quot;, // Element with link to download results as CSV&#10;   &quot;pagesTopElementId&quot;: &quot;paginationTop&quot;, // Element to display result page links above results&#10;   &quot;pagesBotElementId&quot;: &quot;paginationBot&quot;, // Element to display result page links below results&#10;   &quot;showPages&quot;: 5, // MUST BE ODD NUMBER! Max number of page links to show&#10;   &quot;sortDiv&quot;: &quot;sortDiv&quot;, // Element with interactive sort options&#10;   &quot;useCiteService&quot;: true, // true if we should use EDI Cite service to build citations instead of building from PASTA results,&#10;   &quot;showAbstracts&quot;: true, // true if we should show abstracts in search results&#10;   &quot;abstractLimit&quot;: 500 // Limit the number of characters in the abstract&#10;};&#10;&#10;// --- Legacy server-driven search and pagination logic removed for client-side faceted search migration ---&#10;&#10;// Get URL arguments&#10;function getParameterByName(name, url) {&#10;   if (!url) url = window.location.href;&#10;   name = name.replace(/[\[\]]/g, &quot;\\$&amp;&quot;);&#10;   var regex = new RegExp(&quot;[?&amp;]&quot; + name + &quot;(=([^&amp;#]*)|&amp;|#|$)&quot;),&#10;      results = regex.exec(url);&#10;   if (!results) return null;&#10;   if (!results[2]) return &quot;&quot;;&#10;   return decodeURIComponent(results[2].replace(/\+/g, &quot; &quot;)).trim();&#10;}&#10;&#10;// Parse citation dictionary into HTML&#10;function buildHtml(citations, abstracts) {&#10;   var html = [];&#10;   var citationCount = Object.keys(citations).length;&#10;&#10;   for (var i = 0; i &lt; citationCount; i++) {&#10;      var citation = citations[i];&#10;      var abstract = abstracts[i];&#10;      if (abstract.length &gt; PASTA_CONFIG[&quot;abstractLimit&quot;]) {&#10;         abstract = abstract.substring(0, PASTA_CONFIG[&quot;abstractLimit&quot;]) + &quot;...&quot;;&#10;      }&#10;      var authors = citation[&quot;authors&quot;];&#10;      var date = (citation[&quot;pub_year&quot;]) ? &quot; Published &quot; + citation[&quot;pub_year&quot;] + &quot;&quot; : &quot;&quot;;&#10;      // default ESIP formatting has trailing period after DOI&#10;      var link = (citation[&quot;doi&quot;]) ? citation[&quot;doi&quot;].slice(0, -1) : &quot;https://portal.edirepository.org/nis/mapbrowse?packageid=&quot; + citation[&quot;pid&quot;];&#10;      var title = '&lt;a rel=&quot;external noopener&quot; href=&quot;' + link + '&quot; target=&quot;_blank&quot; aria-label=&quot;open data in new tab&quot;&gt;' + citation[&quot;title&quot;] + '&lt;/a&gt;';&#10;      if (PASTA_CONFIG[&quot;showAbstracts&quot;]) {&#10;         var row = '&lt;p&gt;&lt;span class=&quot;dataset-title&quot;&gt;' + title +&#10;            '&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;dataset-author&quot;&gt;' + authors + date +&#10;            '&lt;/span&gt;&lt;br&gt;' + abstract + '&lt;/p&gt;';&#10;      } else {&#10;         var row = '&lt;p&gt;&lt;span class=&quot;dataset-title&quot;&gt;' + title +&#10;            '&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;dataset-author&quot;&gt;' + authors + date +&#10;            '&lt;/span&gt;&lt;/p&gt;';&#10;      }&#10;      html.push(row);&#10;   }&#10;   if (citationCount) {&#10;      return html.join(&quot;\n&quot;);&#10;   } else {&#10;      return &quot;&lt;p&gt;Your search returned no results.&lt;/p&gt;&quot;;&#10;   }&#10;}&#10;&#10;// Download citations to a dictionary keyed by package ID&#10;function getCitations(packageIds, abstracts) {&#10;   var header = {&#10;      &quot;Accept&quot;: &quot;application/json&quot;&#10;   };&#10;   var callsRemaining = packageIds.length;&#10;   var baseUri = &quot;https://cite.edirepository.org/cite/&quot;;&#10;   var citations = {};&#10;&#10;   packageIds.forEach(function (pid, index) {&#10;      var uri = baseUri + pid;&#10;      makeCorsRequest(&#10;         uri,&#10;         header,&#10;         (function (index) { // enable the callback to know which package this is&#10;            return function (headers, response) {&#10;               var citation = JSON.parse(response);&#10;               citation[&quot;pid&quot;] = packageIds[index];&#10;               citations[index] = citation;&#10;&#10;               --callsRemaining;&#10;               if (callsRemaining &lt;= 0) {&#10;                  var html = buildHtml(citations, abstracts);&#10;                  document.getElementById(&quot;searchResults&quot;).innerHTML = html;&#10;                  showLoading(false);&#10;               }&#10;            };&#10;         })(index), // immediately call the closure with the current index value&#10;         errorCallback&#10;      );&#10;   });&#10;}&#10;&#10;// Build dataset citations using Cite service, with package IDs from PASTA&#10;function buildCitationsFromCite(pastaDocs) {&#10;   var packageIds = [];&#10;   var abstracts = [];&#10;   for (var i = 0; i &lt; pastaDocs.length; i++) {&#10;      var doc = pastaDocs[i];&#10;      packageIds.push(doc.getElementsByTagName(&quot;packageid&quot;)[0].childNodes[0].nodeValue);&#10;      abstracts.push(doc.getElementsByTagName(&quot;abstract&quot;)[0].childNodes[0].nodeValue);&#10;   }&#10;   if (packageIds.length) {&#10;      getCitations(packageIds, abstracts);&#10;   } else {&#10;      document.getElementById(&quot;searchResults&quot;).innerHTML = &quot;&lt;p&gt;Your search returned no results.&lt;/p&gt;&quot;;&#10;      showLoading(false);&#10;   }&#10;}&#10;&#10;// Build dataset citations from PASTA XML&#10;function buildCitationsFromPasta(pastaDocs) {&#10;   var html = [];&#10;   for (var i = 0; i &lt; pastaDocs.length; i++) {&#10;      var doc = pastaDocs[i];&#10;      var authorNodes = doc.getElementsByTagName(&quot;author&quot;);&#10;      var authors = [];&#10;      for (var authorIndex = 0; authorIndex &lt; authorNodes.length; authorIndex++) {&#10;         authors.push(authorNodes[authorIndex].innerHTML);&#10;      }&#10;&#10;      var names = authors.join(&quot;; &quot;);&#10;      var date;&#10;      try {&#10;         date = &quot; (Published &quot; + doc.getElementsByTagName(&quot;pubdate&quot;)[0].childNodes[0].nodeValue + &quot;)&quot;;&#10;      } catch (error) {&#10;         date = &quot;&quot;;&#10;      }&#10;      var link = &quot;&quot;;&#10;      try {&#10;         var doi = doc.getElementsByTagName(&quot;doi&quot;)[0].childNodes[0].nodeValue;&#10;         if (doi.slice(0, 4) === &quot;doi:&quot;) {&#10;            doi = doi.slice(4);&#10;         }&#10;         link = &quot;http://dx.doi.org/&quot; + doi;&#10;      } catch (err) {&#10;         link = (&quot;https://portal.edirepository.org/nis/mapbrowse?packageid=&quot; +&#10;            doc.getElementsByTagName(&quot;packageid&quot;)[0].childNodes[0].nodeValue);&#10;      }&#10;      var title = '&lt;a rel=&quot;external noopener&quot; href=&quot;' + link + '&quot; target=&quot;_blank&quot; aria-label=&quot;open data in new tab&quot;&gt;' +&#10;         doc.getElementsByTagName(&quot;title&quot;)[0].childNodes[0].nodeValue.trim() + '&lt;/a&gt;';&#10;      var abstract;&#10;      try {&#10;         abstract = '&lt;br&gt;&lt;span class=&quot;dataset-abstract&quot;&gt;' + doc.getElementsByTagName(&quot;abstract&quot;)[0].childNodes[0].nodeValue + '&lt;/span&gt;';&#10;         if (abstract.length &gt; PASTA_CONFIG[&quot;abstractLimit&quot;]) {&#10;            abstract = abstract.substring(0, PASTA_CONFIG[&quot;abstractLimit&quot;]) + &quot;...&quot;;&#10;         }&#10;      } catch (error) {&#10;         abstract = '';&#10;      }&#10;      if (PASTA_CONFIG[&quot;showAbstracts&quot;]) {&#10;         var row = '&lt;p&gt;&lt;span class=&quot;dataset-title&quot;&gt;' + title +&#10;            '&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;dataset-author&quot;&gt;' + names + date +&#10;            '&lt;/span&gt;' + abstract + '&lt;/p&gt;';&#10;      } else {&#10;         var row = '&lt;p&gt;&lt;span class=&quot;dataset-title&quot;&gt;' + title +&#10;            '&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;dataset-author&quot;&gt;' + names + date +&#10;            '&lt;/span&gt;&lt;/p&gt;';&#10;      }&#10;      html.push(row);&#10;   }&#10;   var resultHtml;&#10;   if (html.length) {&#10;      resultHtml = html.join(&quot;\n&quot;);&#10;   } else {&#10;      resultHtml = &quot;&lt;p&gt;Your search returned no results.&lt;/p&gt;&quot;;&#10;   }&#10;   document.getElementById(&quot;searchResults&quot;).innerHTML = resultHtml;&#10;   showLoading(false);&#10;}&#10;&#10;function showLoading(isLoading) {&#10;   var x = document.getElementById(&quot;loading-div&quot;);&#10;   if (isLoading) {&#10;      document.body.style.cursor = &quot;wait&quot;;&#10;      x.style.display = &quot;block&quot;;&#10;   } else {&#10;      document.body.style.cursor = &quot;default&quot;;&#10;      x.style.display = &quot;none&quot;;&#10;   }&#10;}&#10;&#10;function setHtml(elId, innerHtml) {&#10;   var el = document.getElementById(elId);&#10;   if (el)&#10;      el.innerHTML = innerHtml;&#10;}&#10;&#10;// Function to call if CORS request is successful&#10;function successCallback(headers, response) {&#10;   function makeCsvLink(count) {&#10;      if (!count) return &quot;&quot;;&#10;      var html = '&lt;a href=&quot;&quot; onclick=&quot;return downloadCsv(' + count + ');&quot;&gt;' +&#10;         'Download all results as CSV&lt;/a&gt;';&#10;      return html;&#10;   }&#10;&#10;   // Write results to page&#10;   var parser = new DOMParser();&#10;   var xmlDoc = parser.parseFromString(response, &quot;text/xml&quot;);&#10;   var docs = xmlDoc.getElementsByTagName(&quot;document&quot;);&#10;   var sortDiv = document.getElementById(PASTA_CONFIG[&quot;sortDiv&quot;]);&#10;   if (sortDiv) {&#10;      if (docs.length)&#10;         sortDiv.style.display = &quot;block&quot;;&#10;      else&#10;         sortDiv.style.display = &quot;none&quot;;&#10;   }&#10;   if (PASTA_CONFIG[&quot;useCiteService&quot;]) {&#10;      buildCitationsFromCite(docs);&#10;   } else {&#10;      buildCitationsFromPasta(docs);&#10;   }&#10;   var count = parseInt(xmlDoc.getElementsByTagName(&quot;resultset&quot;)[0].getAttribute(&quot;numFound&quot;));&#10;   setHtml(PASTA_CONFIG[&quot;csvElementId&quot;], makeCsvLink(count));&#10;&#10;   // Add links to additional search result pages if necessary&#10;   var currentStart = getParameterByName(&quot;start&quot;);&#10;   if (!currentStart) {&#10;      currentStart = 0;&#10;   } else {&#10;      currentStart = parseInt(currentStart);&#10;   }&#10;   var limit = parseInt(PASTA_CONFIG[&quot;limit&quot;]);&#10;   var showPages = parseInt(PASTA_CONFIG[&quot;showPages&quot;]);&#10;   var pageTopElementId = PASTA_CONFIG[&quot;pagesTopElementId&quot;];&#10;   var pageBotElementId = PASTA_CONFIG[&quot;pagesBotElementId&quot;];&#10;   showPageLinks(count, limit, showPages, currentStart, pageTopElementId);&#10;   showPageLinks(count, limit, showPages, currentStart, pageBotElementId);&#10;   var query = getParameterByName(&quot;q&quot;);&#10;   showResultCount(query, count, limit, currentStart, PASTA_CONFIG[&quot;countElementId&quot;]);&#10;}&#10;&#10;// Function to call if CORS request fails&#10;function errorCallback() {&#10;   showLoading(false);&#10;   alert(&quot;There was an error making the request.&quot;);&#10;}&#10;&#10;// Writes CORS request URL to the page so user can see it&#10;function showUrl(url) {&#10;   var txt = '&lt;a href=&quot;' + url + '&quot; target=&quot;_blank&quot;&gt;' + url + '&lt;/a&gt;';&#10;   setHtml(PASTA_CONFIG[&quot;urlElementId&quot;], txt);&#10;}&#10;&#10;// Passes search URL and callbacks to CORS function&#10;function searchPasta(limit, pageStart) {&#10;   var params = &quot;&amp;rows=&quot; + limit + &quot;&amp;start=&quot; + pageStart;&#10;   var url = QUERY_URL + params;&#10;   showUrl(url);&#10;   showLoading(true);&#10;   makeCorsRequest(url, null, successCallback, errorCallback);&#10;}&#10;&#10;function initCollapsible(expanded) {&#10;   // Handles collapsible sections&#10;   function showHide(el, show) {&#10;      if (show) el.style.maxHeight = &quot;900px&quot;;&#10;      else el.style.maxHeight = null;&#10;   }&#10;&#10;   // Expand if user tabs into hidden element&#10;   function listenForFocus(collapsibleEl, toggle) {&#10;      function addFocusListener(collapsibleEl, tagName, toggle) {&#10;         var els = collapsibleEl.getElementsByTagName(tagName);&#10;         var i;&#10;         for (i = 0; i &lt; els.length; i++) {&#10;            els[i].onfocus = function () {&#10;               if (!toggle.checked) toggle.click();&#10;            };&#10;         };&#10;      }&#10;      addFocusListener(collapsibleEl, &quot;SELECT&quot;, toggle);&#10;      addFocusListener(collapsibleEl, &quot;INPUT&quot;, toggle);&#10;   }&#10;&#10;   // Collapse when checked&#10;   var els = document.getElementsByClassName(&quot;collapse-toggle&quot;);&#10;   var i;&#10;   for (i = 0; i &lt; els.length; i++) {&#10;      var el = els[i];&#10;      if (el.type &amp;&amp; el.type === 'checkbox') {&#10;         el.checked = expanded;&#10;         var target = document.getElementById(el.getAttribute(&quot;aria-controls&quot;));&#10;         listenForFocus(target, el);&#10;         showHide(target, expanded);&#10;         el.setAttribute(&quot;aria-expanded&quot;, expanded.toString());&#10;         el.onchange = function () {&#10;            showHide(target, this.checked);&#10;            this.setAttribute(&quot;aria-expanded&quot;, this.checked.toString());&#10;         };&#10;      }&#10;   }&#10;   // Toggle checkbox when user presses space or enter on label&#10;   els = document.getElementsByClassName(&quot;lbl-toggle&quot;);&#10;   for (i = 0; i &lt; els.length; i++) {&#10;      var label = els[i];&#10;      label.onkeydown = function (e) {&#10;         if (e.which === 32 || e.which === 13) {&#10;            e.preventDefault();&#10;            this.click();&#10;         };&#10;      };&#10;   };&#10;}&#10;&#10;function clearParams() {&#10;   var areas = document.getElementById(&quot;coreArea&quot;);&#10;   areas[0].selected = true;&#10;   document.forms.dataSearchForm.creator.value = &quot;&quot;;&#10;   document.forms.dataSearchForm.project.value = &quot;&quot;;&#10;//    document.forms.dataSearchForm.identifier.value = &quot;&quot;;&#10;   document.forms.dataSearchForm.taxon.value = &quot;&quot;;&#10;   document.forms.dataSearchForm.geo.value = &quot;&quot;;&#10;   document.forms.dataSearchForm.data_year.checked = false;&#10;   document.forms.dataSearchForm.publish_year.checked = false;&#10;   document.forms.dataSearchForm.min_year.value = &quot;1900&quot;;&#10;   document.forms.dataSearchForm.max_year.value = &quot;2022&quot;;&#10;}&#10;&#10;// Selects the desired value in the Select control. If value is not in the&#10;// control, then first index is used. Returns actual selected value.&#10;function setSelectValue(elId, desiredValue) {&#10;   var el = document.getElementById(elId);&#10;   if (!el || !el.length) return null;&#10;   var result = el[0].value;&#10;   for (var i = 0; i &lt; el.length; i++) {&#10;      if (desiredValue === el[i].value) {&#10;         el[i].selected = true;&#10;         result = desiredValue;&#10;         break;&#10;      }&#10;   }&#10;   return result;&#10;}&#10;&#10;function isInteger(x) {&#10;   return (typeof x === 'number') &amp;&amp; (x % 1 === 0);&#10;}&#10;&#10;function makeAutocomplete(elementId, choices, minChars) {&#10;   if (!minChars) minChars = 2;&#10;   var autocomplete = new autoComplete({&#10;      selector: &quot;#&quot; + elementId,&#10;      minChars: minChars,&#10;      source: function (term, suggest) {&#10;         term = term.toLowerCase();&#10;         var suggestions = [];&#10;         for (var i = 0; i &lt; choices.length; i++)&#10;            if (~choices[i].toLowerCase().indexOf(term))&#10;               suggestions.push(choices[i]);&#10;         suggest(suggestions);&#10;      }&#10;   });&#10;   return autocomplete;&#10;}&#10;&#10;// --- Faceted Creator Dropdown Logic ---&#10;// Store all results for client-side filtering&#10;var ALL_PASTA_DOCS = [];&#10;&#10;function renderCreatorCheckboxes(creators, selected, creatorCounts) {&#10;  return creators.map(function(creator, i) {&#10;    var checked = selected.includes(creator) ? 'checked' : '';&#10;    var count = creatorCounts[creator] || 0;&#10;    return `&lt;label style=&quot;display:flex;align-items:center;padding:2px 12px 2px 8px;cursor:pointer;font-size:0.98em;&quot;&gt;&#10;      &lt;input type=&quot;checkbox&quot; class=&quot;creator-checkbox&quot; value=&quot;${creator.replace(/&amp;/g,'&amp;amp;').replace(/\&quot;/g,'&amp;quot;')}&quot; ${checked} style=&quot;margin-right:8px;&quot;&gt;${creator} &lt;span style='color:#888;font-size:0.95em;margin-left:6px;'&quot;&gt;(${count})&lt;/span&gt;&#10;    &lt;/label&gt;`;&#10;  }).join('');&#10;}&#10;&#10;function getSelectedCreators() {&#10;  var boxes = document.querySelectorAll('.creator-checkbox:checked');&#10;  return Array.from(boxes).map(function(box) { return box.value; });&#10;}&#10;&#10;function populateCreatorFacetOptions(docs, selected) {&#10;   var creatorSet = new Set();&#10;   var creatorCounts = {};&#10;   for (var i = 0; i &lt; docs.length; i++) {&#10;      var authorNodes = docs[i].getElementsByTagName(&quot;author&quot;);&#10;      for (var j = 0; j &lt; authorNodes.length; j++) {&#10;         var creator = authorNodes[j].innerHTML;&#10;         creatorSet.add(creator);&#10;         creatorCounts[creator] = (creatorCounts[creator] || 0) + 1;&#10;      }&#10;   }&#10;   var creatorDropdown = document.getElementById(&quot;creator-dropdown&quot;);&#10;   var creators = Array.from(creatorSet).sort();&#10;   creatorDropdown.innerHTML = renderCreatorCheckboxes(creators, selected || [], creatorCounts);&#10;}&#10;&#10;function filterDocsByCreators(docs, selectedCreators) {&#10;   if (!selectedCreators.length) return docs;&#10;   return docs.filter(function(doc) {&#10;      var authorNodes = doc.getElementsByTagName(&quot;author&quot;);&#10;      var authors = Array.from(authorNodes).map(function(n) { return n.innerHTML; });&#10;      return selectedCreators.some(function(sel) { return authors.includes(sel); });&#10;   });&#10;}&#10;&#10;// --- Faceted Keyword Dropdown Logic ---&#10;function renderKeywordCheckboxes(keywords, selected, keywordCounts) {&#10;  return keywords.map(function(keyword, i) {&#10;    var checked = selected.includes(keyword) ? 'checked' : '';&#10;    var count = keywordCounts[keyword] || 0;&#10;    return `&lt;label style=&quot;display:flex;align-items:center;padding:2px 12px 2px 8px;cursor:pointer;font-size:0.98em;&quot;&gt;&#10;      &lt;input type=&quot;checkbox&quot; class=&quot;keyword-checkbox&quot; value=&quot;${keyword.replace(/&amp;/g,'&amp;amp;').replace(/\&quot;/g,'&amp;quot;')}&quot; ${checked} style=&quot;margin-right:8px;&quot;&gt;${keyword} &lt;span style='color:#888;font-size:0.95em;margin-left:6px;'&quot;&gt;(${count})&lt;/span&gt;&#10;    &lt;/label&gt;`;&#10;  }).join('');&#10;}&#10;&#10;function getSelectedKeywords() {&#10;  var boxes = document.querySelectorAll('.keyword-checkbox:checked');&#10;  return Array.from(boxes).map(function(box) { return box.value; });&#10;}&#10;&#10;function populateKeywordFacetOptions(docs, selected) {&#10;   var keywordSet = new Set();&#10;   var keywordCounts = {};&#10;   for (var i = 0; i &lt; docs.length; i++) {&#10;      var keywordNodes = docs[i].getElementsByTagName(&quot;keyword&quot;);&#10;      for (var j = 0; j &lt; keywordNodes.length; j++) {&#10;         var keyword = keywordNodes[j].innerHTML;&#10;         keywordSet.add(keyword);&#10;         keywordCounts[keyword] = (keywordCounts[keyword] || 0) + 1;&#10;      }&#10;   }&#10;   var keywordDropdown = document.getElementById(&quot;keyword-dropdown&quot;);&#10;   var keywords = Array.from(keywordSet).sort();&#10;   keywordDropdown.innerHTML = renderKeywordCheckboxes(keywords, selected || [], keywordCounts);&#10;}&#10;&#10;function filterDocsByKeywords(docs, selectedKeywords) {&#10;   if (!selectedKeywords.length) return docs;&#10;   return docs.filter(function(doc) {&#10;      var keywordNodes = doc.getElementsByTagName(&quot;keyword&quot;);&#10;      var keywords = Array.from(keywordNodes).map(function(n) { return n.innerHTML; });&#10;      return selectedKeywords.some(function(sel) { return keywords.includes(sel); });&#10;   });&#10;}&#10;&#10;// Patch successCallback to store all docs and update creator and keyword facets&#10;var origSuccessCallback = successCallback;&#10;successCallback = function(headers, response) {&#10;   var parser = new DOMParser();&#10;   var xmlDoc = parser.parseFromString(response, &quot;text/xml&quot;);&#10;   var docs = Array.from(xmlDoc.getElementsByTagName(&quot;document&quot;));&#10;   ALL_PASTA_DOCS = docs;&#10;   var selectedCreators = getSelectedCreators();&#10;   var selectedKeywords = getSelectedKeywords();&#10;   populateCreatorFacetOptions(docs, selectedCreators);&#10;   populateKeywordFacetOptions(docs, selectedKeywords);&#10;   var filteredDocs = filterDocsByCreators(docs, selectedCreators);&#10;   filteredDocs = filterDocsByKeywords(filteredDocs, selectedKeywords);&#10;   if (PASTA_CONFIG[&quot;useCiteService&quot;]) {&#10;      buildCitationsFromCite(filteredDocs);&#10;   } else {&#10;      buildCitationsFromPasta(filteredDocs);&#10;   }&#10;   var count = filteredDocs.length;&#10;   setHtml(PASTA_CONFIG[&quot;csvElementId&quot;], '');&#10;   var currentStart = getParameterByName(&quot;start&quot;);&#10;   if (!currentStart) currentStart = 0; else currentStart = parseInt(currentStart);&#10;   var limit = parseInt(PASTA_CONFIG[&quot;limit&quot;]);&#10;   var showPages = parseInt(PASTA_CONFIG[&quot;showPages&quot;]);&#10;   var pageTopElementId = PASTA_CONFIG[&quot;pagesTopElementId&quot;];&#10;   var pageBotElementId = PASTA_CONFIG[&quot;pagesBotElementId&quot;];&#10;   showPageLinks(count, limit, showPages, currentStart, pageTopElementId);&#10;   showPageLinks(count, limit, showPages, currentStart, pageBotElementId);&#10;   var query = getParameterByName(&quot;q&quot;);&#10;   showResultCount(query, count, limit, currentStart, PASTA_CONFIG[&quot;countElementId&quot;]);&#10;}&#10;&#10;document.addEventListener(&quot;DOMContentLoaded&quot;, function() {&#10;   // Fetch initial dataset from PASTA server and initialize facets/results&#10;   var url = PASTA_CONFIG.server + &quot;fl=title,pubdate,doi,packageid,author,abstract,keyword&amp;defType=edismax&quot; + PASTA_CONFIG.filter + &quot;&amp;q=*&amp;rows=1000&quot;;&#10;   showLoading(true);&#10;   makeCorsRequest(url, null, function(headers, response) {&#10;      var parser = new DOMParser();&#10;      var xmlDoc = parser.parseFromString(response, &quot;text/xml&quot;);&#10;      var docs = Array.from(xmlDoc.getElementsByTagName(&quot;document&quot;));&#10;      ALL_PASTA_DOCS = docs;&#10;      populateCreatorFacetOptions(docs, []);&#10;      populateKeywordFacetOptions(docs, []);&#10;      // Render all results initially&#10;      if (PASTA_CONFIG[&quot;useCiteService&quot;]) {&#10;         buildCitationsFromCite(docs);&#10;      } else {&#10;         buildCitationsFromPasta(docs);&#10;      }&#10;      showLoading(false);&#10;   }, errorCallback);&#10;&#10;   var creatorToggleBtn = document.getElementById(&quot;creator-toggle-btn&quot;);&#10;   var creatorDropdown = document.getElementById(&quot;creator-dropdown&quot;);&#10;   var creatorArrow = document.getElementById(&quot;creator-arrow&quot;);&#10;   var expanded = false;&#10;   if (creatorToggleBtn &amp;&amp; creatorDropdown &amp;&amp; creatorArrow) {&#10;      creatorToggleBtn.addEventListener(&quot;click&quot;, function(e) {&#10;         e.preventDefault();&#10;         expanded = !expanded;&#10;         if (expanded) {&#10;            creatorDropdown.style.display = &quot;block&quot;;&#10;            creatorArrow.innerHTML = &quot;&amp;#x25B2;&quot;;&#10;            creatorDropdown.focus();&#10;         } else {&#10;            creatorDropdown.style.display = &quot;none&quot;;&#10;            creatorArrow.innerHTML = &quot;&amp;#x25BC;&quot;;&#10;         }&#10;      });&#10;      // Optional: collapse when focus is lost&#10;      creatorDropdown.addEventListener(&quot;blur&quot;, function(e) {&#10;         setTimeout(function() {&#10;            // Only collapse if focus is not on a child element (e.g., a checkbox)&#10;            if (!creatorDropdown.contains(document.activeElement)) {&#10;               creatorDropdown.style.display = &quot;none&quot;;&#10;               creatorArrow.innerHTML = &quot;&amp;#x25BC;&quot;;&#10;               expanded = false;&#10;            }&#10;         }, 150);&#10;      });&#10;      // Debounce utility&#10;      function debounce(func, wait) {&#10;        var timeout;&#10;        return function() {&#10;          var context = this, args = arguments;&#10;          clearTimeout(timeout);&#10;          timeout = setTimeout(function() {&#10;            func.apply(context, args);&#10;          }, wait);&#10;        };&#10;      }&#10;      // Unified handler for facet (creator/keyword) changes&#10;      var processFacetChange = debounce(function() {&#10;        var selectedCreators = getSelectedCreators();&#10;        var selectedKeywords = getSelectedKeywords();&#10;        // Apply both filters to get filteredDocs&#10;        var filteredDocs = filterDocsByCreators(ALL_PASTA_DOCS, selectedCreators || []);&#10;        filteredDocs = filterDocsByKeywords(filteredDocs, selectedKeywords || []);&#10;        // Dynamically update facet options based on filteredDocs&#10;        populateCreatorFacetOptions(filteredDocs, selectedCreators);&#10;        populateKeywordFacetOptions(filteredDocs, selectedKeywords);&#10;        // Render filtered results&#10;        if (PASTA_CONFIG[&quot;useCiteService&quot;]) {&#10;          buildCitationsFromCite(filteredDocs);&#10;        } else {&#10;          buildCitationsFromPasta(filteredDocs);&#10;        }&#10;        var count = filteredDocs.length;&#10;        setHtml(PASTA_CONFIG[&quot;csvElementId&quot;], '');&#10;        var currentStart = 0;&#10;        var limit = parseInt(PASTA_CONFIG[&quot;limit&quot;]);&#10;        var showPages = parseInt(PASTA_CONFIG[&quot;showPages&quot;]);&#10;        var pageTopElementId = PASTA_CONFIG[&quot;pagesTopElementId&quot;];&#10;        var pageBotElementId = PASTA_CONFIG[&quot;pagesBotElementId&quot;];&#10;        showPageLinks(count, limit, showPages, currentStart, pageTopElementId);&#10;        showPageLinks(count, limit, showPages, currentStart, pageBotElementId);&#10;        var query = getParameterByName(&quot;q&quot;);&#10;        showResultCount(query, count, limit, currentStart, PASTA_CONFIG[&quot;countElementId&quot;]);&#10;      }, 200);&#10;      // Listen for creator checkbox changes&#10;      creatorDropdown.addEventListener(&quot;change&quot;, function(e) {&#10;        if (e.target.classList.contains('creator-checkbox')) {&#10;          processFacetChange();&#10;        }&#10;      });&#10;   }&#10;   // Keyword dropdown logic&#10;   var keywordToggleBtn = document.getElementById(&quot;keyword-toggle-btn&quot;);&#10;   var keywordDropdown = document.getElementById(&quot;keyword-dropdown&quot;);&#10;   var keywordArrow = document.getElementById(&quot;keyword-arrow&quot;);&#10;   var keywordExpanded = false;&#10;   if (keywordToggleBtn &amp;&amp; keywordDropdown &amp;&amp; keywordArrow) {&#10;      keywordToggleBtn.addEventListener(&quot;click&quot;, function(e) {&#10;         e.preventDefault();&#10;         keywordExpanded = !keywordExpanded;&#10;         if (keywordExpanded) {&#10;            keywordDropdown.style.display = &quot;block&quot;;&#10;            keywordArrow.innerHTML = &quot;\u25B2&quot;; // Remove the semicolon&#10;            keywordDropdown.focus();&#10;         } else {&#10;            keywordDropdown.style.display = &quot;none&quot;;&#10;            keywordArrow.innerHTML = &quot;\u25BC&quot;; // Remove the semicolon&#10;         }&#10;      });&#10;      keywordDropdown.addEventListener(&quot;blur&quot;, function(e) {&#10;         setTimeout(function() {&#10;            if (!keywordDropdown.contains(document.activeElement)) {&#10;               keywordDropdown.style.display = &quot;none&quot;;&#10;               keywordArrow.innerHTML = &quot;\u25BC&quot;; // Remove the semicolon&#10;               keywordExpanded = false;&#10;            }&#10;         }, 150);&#10;      });&#10;      // Listen for keyword checkbox changes&#10;      keywordDropdown.addEventListener(&quot;change&quot;, function(e) {&#10;        if (e.target.classList.contains('keyword-checkbox')) {&#10;          processFacetChange();&#10;        }&#10;      });&#10;   }&#10;});&#10;&#10;// When the window loads, read query parameters and perform search&#10;window.onload = function () {&#10;   function initApp(expanded) {&#10;      initCollapsible(expanded);&#10;&#10;      var sortControl = document.getElementById(&quot;visibleSort&quot;);&#10;      if (sortControl) {&#10;         sortControl.onchange = function () {&#10;            var hiddenSortControl = document.getElementById(&quot;sort&quot;);&#10;            hiddenSortControl.value = this.options[this.selectedIndex].value;&#10;            var form = document.getElementById(&quot;dataSearchForm&quot;);&#10;            form.submit();&#10;         };&#10;      }&#10;   }&#10;&#10;   var query = getParameterByName(&quot;q&quot;);&#10;   var coreAreaParam = getParameterByName(&quot;coreArea&quot;);&#10;   var creator = getParameterByName(&quot;creator&quot;);&#10;   var project = getParameterByName(&quot;project&quot;);&#10;   var sYear = parseInt(getParameterByName(&quot;s&quot;));&#10;   var eYear = parseInt(getParameterByName(&quot;e&quot;));&#10;   var datayear = getParameterByName(&quot;datayear&quot;) === &quot;y&quot;;&#10;   var pubyear = getParameterByName(&quot;pubyear&quot;) === &quot;y&quot;;&#10;   var pkgId = getParameterByName(&quot;id&quot;);&#10;   var taxon = getParameterByName(&quot;taxon&quot;);&#10;   var geo = getParameterByName(&quot;geo&quot;);&#10;   var expanded = Boolean(getParameterByName(&quot;expanded&quot;));&#10;   var pageStart = getParameterByName(&quot;start&quot;);&#10;   var sortParam = getParameterByName(&quot;sort&quot;);&#10;   if (!pageStart) pageStart = 0;&#10;&#10;   initApp(expanded);&#10;&#10;   if (!query) query = &quot;*&quot;; // default for empty query&#10;   QUERY_URL = makeQueryUrlBase(query, coreArea, creator, sYear, eYear,&#10;      datayear, pubyear, pkgId, taxon, geo, project, sortParam)&#10;   searchPasta(PASTA_CONFIG[&quot;limit&quot;], pageStart);&#10;&#10;   if (&quot;PASTA_LOOKUP&quot; in window) {&#10;      makeAutocomplete(&quot;creator&quot;, PASTA_LOOKUP[&quot;author&quot;]);&#10;      makeAutocomplete(&quot;project&quot;, PASTA_LOOKUP[&quot;projectTitle&quot;].concat(PASTA_LOOKUP[&quot;relatedProjectTitle&quot;]));&#10;      makeAutocomplete(&quot;taxon&quot;, PASTA_LOOKUP[&quot;taxonomic&quot;]);&#10;   }&#10;};&#10;" />
              <option name="updatedContent" value="// Requires cors.js and pagination.js to be loaded first&#10;&#10;&quot;use strict&quot;;&#10;&#10;var PASTA_CONFIG = {&#10;   &quot;server&quot;: &quot;https://pasta.lternet.edu/package/search/eml?&quot;, // PASTA server&#10;   &quot;filter&quot;: '&amp;fq=keyword:&quot;Archbold Biological Station&quot;', // Filter results on a unique keyword of a research group&#10;   &quot;limit&quot;: 20, // Max number of results to retrieve per page&#10;   &quot;resultsElementId&quot;: &quot;searchResults&quot;, // Element to contain results&#10;   &quot;urlElementId&quot;: &quot;searchUrl&quot;, // Element to display search URL. Use &quot;searchUrl&quot; to display or &quot;&quot; to remove FIXME: Empty string does not turn off.&#10;   &quot;countElementId&quot;: &quot;resultCount&quot;, // Element showing number of results&#10;   &quot;csvElementId&quot;: &quot;csvDownload&quot;, // Element with link to download results as CSV&#10;   &quot;pagesTopElementId&quot;: &quot;paginationTop&quot;, // Element to display result page links above results&#10;   &quot;pagesBotElementId&quot;: &quot;paginationBot&quot;, // Element to display result page links below results&#10;   &quot;showPages&quot;: 5, // MUST BE ODD NUMBER! Max number of page links to show&#10;   &quot;sortDiv&quot;: &quot;sortDiv&quot;, // Element with interactive sort options&#10;   &quot;useCiteService&quot;: true, // true if we should use EDI Cite service to build citations instead of building from PASTA results,&#10;   &quot;showAbstracts&quot;: true, // true if we should show abstracts in search results&#10;   &quot;abstractLimit&quot;: 500 // Limit the number of characters in the abstract&#10;};&#10;&#10;// --- Legacy server-driven search and pagination logic removed for client-side faceted search migration ---&#10;&#10;// Get URL arguments&#10;function getParameterByName(name, url) {&#10;   if (!url) url = window.location.href;&#10;   name = name.replace(/[\[\]]/g, &quot;\\$&amp;&quot;);&#10;   var regex = new RegExp(&quot;[?&amp;]&quot; + name + &quot;(=([^&amp;#]*)|&amp;|#|$)&quot;),&#10;      results = regex.exec(url);&#10;   if (!results) return null;&#10;   if (!results[2]) return &quot;&quot;;&#10;   return decodeURIComponent(results[2].replace(/\+/g, &quot; &quot;)).trim();&#10;}&#10;&#10;// Parse citation dictionary into HTML&#10;function buildHtml(citations, abstracts) {&#10;   var html = [];&#10;   var citationCount = Object.keys(citations).length;&#10;&#10;   for (var i = 0; i &lt; citationCount; i++) {&#10;      var citation = citations[i];&#10;      var abstract = abstracts[i];&#10;      if (abstract.length &gt; PASTA_CONFIG[&quot;abstractLimit&quot;]) {&#10;         abstract = abstract.substring(0, PASTA_CONFIG[&quot;abstractLimit&quot;]) + &quot;...&quot;;&#10;      }&#10;      var authors = citation[&quot;authors&quot;];&#10;      var date = (citation[&quot;pub_year&quot;]) ? &quot; Published &quot; + citation[&quot;pub_year&quot;] + &quot;&quot; : &quot;&quot;;&#10;      // default ESIP formatting has trailing period after DOI&#10;      var link = (citation[&quot;doi&quot;]) ? citation[&quot;doi&quot;].slice(0, -1) : &quot;https://portal.edirepository.org/nis/mapbrowse?packageid=&quot; + citation[&quot;pid&quot;];&#10;      var title = '&lt;a rel=&quot;external noopener&quot; href=&quot;' + link + '&quot; target=&quot;_blank&quot; aria-label=&quot;open data in new tab&quot;&gt;' + citation[&quot;title&quot;] + '&lt;/a&gt;';&#10;      if (PASTA_CONFIG[&quot;showAbstracts&quot;]) {&#10;         var row = '&lt;p&gt;&lt;span class=&quot;dataset-title&quot;&gt;' + title +&#10;            '&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;dataset-author&quot;&gt;' + authors + date +&#10;            '&lt;/span&gt;&lt;br&gt;' + abstract + '&lt;/p&gt;';&#10;      } else {&#10;         var row = '&lt;p&gt;&lt;span class=&quot;dataset-title&quot;&gt;' + title +&#10;            '&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;dataset-author&quot;&gt;' + authors + date +&#10;            '&lt;/span&gt;&lt;/p&gt;';&#10;      }&#10;      html.push(row);&#10;   }&#10;   if (citationCount) {&#10;      return html.join(&quot;\n&quot;);&#10;   } else {&#10;      return &quot;&lt;p&gt;Your search returned no results.&lt;/p&gt;&quot;;&#10;   }&#10;}&#10;&#10;// Download citations to a dictionary keyed by package ID&#10;function getCitations(packageIds, abstracts) {&#10;   var header = {&#10;      &quot;Accept&quot;: &quot;application/json&quot;&#10;   };&#10;   var callsRemaining = packageIds.length;&#10;   var baseUri = &quot;https://cite.edirepository.org/cite/&quot;;&#10;   var citations = {};&#10;&#10;   packageIds.forEach(function (pid, index) {&#10;      var uri = baseUri + pid;&#10;      makeCorsRequest(&#10;         uri,&#10;         header,&#10;         (function (index) { // enable the callback to know which package this is&#10;            return function (headers, response) {&#10;               var citation = JSON.parse(response);&#10;               citation[&quot;pid&quot;] = packageIds[index];&#10;               citations[index] = citation;&#10;&#10;               --callsRemaining;&#10;               if (callsRemaining &lt;= 0) {&#10;                  var html = buildHtml(citations, abstracts);&#10;                  document.getElementById(&quot;searchResults&quot;).innerHTML = html;&#10;                  showLoading(false);&#10;               }&#10;            };&#10;         })(index), // immediately call the closure with the current index value&#10;         errorCallback&#10;      );&#10;   });&#10;}&#10;&#10;// Build dataset citations using Cite service, with package IDs from PASTA&#10;function buildCitationsFromCite(pastaDocs) {&#10;   var packageIds = [];&#10;   var abstracts = [];&#10;   for (var i = 0; i &lt; pastaDocs.length; i++) {&#10;      var doc = pastaDocs[i];&#10;      packageIds.push(doc.getElementsByTagName(&quot;packageid&quot;)[0].childNodes[0].nodeValue);&#10;      abstracts.push(doc.getElementsByTagName(&quot;abstract&quot;)[0].childNodes[0].nodeValue);&#10;   }&#10;   if (packageIds.length) {&#10;      getCitations(packageIds, abstracts);&#10;   } else {&#10;      document.getElementById(&quot;searchResults&quot;).innerHTML = &quot;&lt;p&gt;Your search returned no results.&lt;/p&gt;&quot;;&#10;      showLoading(false);&#10;   }&#10;}&#10;&#10;// Build dataset citations from PASTA XML&#10;function buildCitationsFromPasta(pastaDocs) {&#10;   var html = [];&#10;   for (var i = 0; i &lt; pastaDocs.length; i++) {&#10;      var doc = pastaDocs[i];&#10;      var authorNodes = doc.getElementsByTagName(&quot;author&quot;);&#10;      var authors = [];&#10;      for (var authorIndex = 0; authorIndex &lt; authorNodes.length; authorIndex++) {&#10;         authors.push(authorNodes[authorIndex].innerHTML);&#10;      }&#10;&#10;      var names = authors.join(&quot;; &quot;);&#10;      var date;&#10;      try {&#10;         date = &quot; (Published &quot; + doc.getElementsByTagName(&quot;pubdate&quot;)[0].childNodes[0].nodeValue + &quot;)&quot;;&#10;      } catch (error) {&#10;         date = &quot;&quot;;&#10;      }&#10;      var link = &quot;&quot;;&#10;      try {&#10;         var doi = doc.getElementsByTagName(&quot;doi&quot;)[0].childNodes[0].nodeValue;&#10;         if (doi.slice(0, 4) === &quot;doi:&quot;) {&#10;            doi = doi.slice(4);&#10;         }&#10;         link = &quot;http://dx.doi.org/&quot; + doi;&#10;      } catch (err) {&#10;         link = (&quot;https://portal.edirepository.org/nis/mapbrowse?packageid=&quot; +&#10;            doc.getElementsByTagName(&quot;packageid&quot;)[0].childNodes[0].nodeValue);&#10;      }&#10;      var title = '&lt;a rel=&quot;external noopener&quot; href=&quot;' + link + '&quot; target=&quot;_blank&quot; aria-label=&quot;open data in new tab&quot;&gt;' +&#10;         doc.getElementsByTagName(&quot;title&quot;)[0].childNodes[0].nodeValue.trim() + '&lt;/a&gt;';&#10;      var abstract;&#10;      try {&#10;         abstract = '&lt;br&gt;&lt;span class=&quot;dataset-abstract&quot;&gt;' + doc.getElementsByTagName(&quot;abstract&quot;)[0].childNodes[0].nodeValue + '&lt;/span&gt;';&#10;         if (abstract.length &gt; PASTA_CONFIG[&quot;abstractLimit&quot;]) {&#10;            abstract = abstract.substring(0, PASTA_CONFIG[&quot;abstractLimit&quot;]) + &quot;...&quot;;&#10;         }&#10;      } catch (error) {&#10;         abstract = '';&#10;      }&#10;      if (PASTA_CONFIG[&quot;showAbstracts&quot;]) {&#10;         var row = '&lt;p&gt;&lt;span class=&quot;dataset-title&quot;&gt;' + title +&#10;            '&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;dataset-author&quot;&gt;' + names + date +&#10;            '&lt;/span&gt;' + abstract + '&lt;/p&gt;';&#10;      } else {&#10;         var row = '&lt;p&gt;&lt;span class=&quot;dataset-title&quot;&gt;' + title +&#10;            '&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;dataset-author&quot;&gt;' + names + date +&#10;            '&lt;/span&gt;&lt;/p&gt;';&#10;      }&#10;      html.push(row);&#10;   }&#10;   var resultHtml;&#10;   if (html.length) {&#10;      resultHtml = html.join(&quot;\n&quot;);&#10;   } else {&#10;      resultHtml = &quot;&lt;p&gt;Your search returned no results.&lt;/p&gt;&quot;;&#10;   }&#10;   document.getElementById(&quot;searchResults&quot;).innerHTML = resultHtml;&#10;   showLoading(false);&#10;}&#10;&#10;function showLoading(isLoading) {&#10;   var x = document.getElementById(&quot;loading-div&quot;);&#10;   if (isLoading) {&#10;      document.body.style.cursor = &quot;wait&quot;;&#10;      x.style.display = &quot;block&quot;;&#10;   } else {&#10;      document.body.style.cursor = &quot;default&quot;;&#10;      x.style.display = &quot;none&quot;;&#10;   }&#10;}&#10;&#10;function setHtml(elId, innerHtml) {&#10;   var el = document.getElementById(elId);&#10;   if (el)&#10;      el.innerHTML = innerHtml;&#10;}&#10;&#10;// Function to call if CORS request is successful&#10;function successCallback(headers, response) {&#10;   function makeCsvLink(count) {&#10;      if (!count) return &quot;&quot;;&#10;      var html = '&lt;a href=&quot;&quot; onclick=&quot;return downloadCsv(' + count + ');&quot;&gt;' +&#10;         'Download all results as CSV&lt;/a&gt;';&#10;      return html;&#10;   }&#10;&#10;   // Write results to page&#10;   var parser = new DOMParser();&#10;   var xmlDoc = parser.parseFromString(response, &quot;text/xml&quot;);&#10;   var docs = xmlDoc.getElementsByTagName(&quot;document&quot;);&#10;   var sortDiv = document.getElementById(PASTA_CONFIG[&quot;sortDiv&quot;]);&#10;   if (sortDiv) {&#10;      if (docs.length)&#10;         sortDiv.style.display = &quot;block&quot;;&#10;      else&#10;         sortDiv.style.display = &quot;none&quot;;&#10;   }&#10;   if (PASTA_CONFIG[&quot;useCiteService&quot;]) {&#10;      buildCitationsFromCite(docs);&#10;   } else {&#10;      buildCitationsFromPasta(docs);&#10;   }&#10;   var count = parseInt(xmlDoc.getElementsByTagName(&quot;resultset&quot;)[0].getAttribute(&quot;numFound&quot;));&#10;   setHtml(PASTA_CONFIG[&quot;csvElementId&quot;], makeCsvLink(count));&#10;&#10;   // Add links to additional search result pages if necessary&#10;   var currentStart = getParameterByName(&quot;start&quot;);&#10;   if (!currentStart) {&#10;      currentStart = 0;&#10;   } else {&#10;      currentStart = parseInt(currentStart);&#10;   }&#10;   var limit = parseInt(PASTA_CONFIG[&quot;limit&quot;]);&#10;   var showPages = parseInt(PASTA_CONFIG[&quot;showPages&quot;]);&#10;   var pageTopElementId = PASTA_CONFIG[&quot;pagesTopElementId&quot;];&#10;   var pageBotElementId = PASTA_CONFIG[&quot;pagesBotElementId&quot;];&#10;   showPageLinks(count, limit, showPages, currentStart, pageTopElementId);&#10;   showPageLinks(count, limit, showPages, currentStart, pageBotElementId);&#10;   var query = getParameterByName(&quot;q&quot;);&#10;   showResultCount(query, count, limit, currentStart, PASTA_CONFIG[&quot;countElementId&quot;]);&#10;}&#10;&#10;// Function to call if CORS request fails&#10;function errorCallback() {&#10;   showLoading(false);&#10;   alert(&quot;There was an error making the request.&quot;);&#10;}&#10;&#10;// Writes CORS request URL to the page so user can see it&#10;function showUrl(url) {&#10;   var txt = '&lt;a href=&quot;' + url + '&quot; target=&quot;_blank&quot;&gt;' + url + '&lt;/a&gt;';&#10;   setHtml(PASTA_CONFIG[&quot;urlElementId&quot;], txt);&#10;}&#10;&#10;// Passes search URL and callbacks to CORS function&#10;function searchPasta(limit, pageStart) {&#10;   var params = &quot;&amp;rows=&quot; + limit + &quot;&amp;start=&quot; + pageStart;&#10;   var url = QUERY_URL + params;&#10;   showUrl(url);&#10;   showLoading(true);&#10;   makeCorsRequest(url, null, successCallback, errorCallback);&#10;}&#10;&#10;function initCollapsible(expanded) {&#10;   // Handles collapsible sections&#10;   function showHide(el, show) {&#10;      if (show) el.style.maxHeight = &quot;900px&quot;;&#10;      else el.style.maxHeight = null;&#10;   }&#10;&#10;   // Expand if user tabs into hidden element&#10;   function listenForFocus(collapsibleEl, toggle) {&#10;      function addFocusListener(collapsibleEl, tagName, toggle) {&#10;         var els = collapsibleEl.getElementsByTagName(tagName);&#10;         var i;&#10;         for (i = 0; i &lt; els.length; i++) {&#10;            els[i].onfocus = function () {&#10;               if (!toggle.checked) toggle.click();&#10;            };&#10;         };&#10;      }&#10;      addFocusListener(collapsibleEl, &quot;SELECT&quot;, toggle);&#10;      addFocusListener(collapsibleEl, &quot;INPUT&quot;, toggle);&#10;   }&#10;&#10;   // Collapse when checked&#10;   var els = document.getElementsByClassName(&quot;collapse-toggle&quot;);&#10;   var i;&#10;   for (i = 0; i &lt; els.length; i++) {&#10;      var el = els[i];&#10;      if (el.type &amp;&amp; el.type === 'checkbox') {&#10;         el.checked = expanded;&#10;         var target = document.getElementById(el.getAttribute(&quot;aria-controls&quot;));&#10;         listenForFocus(target, el);&#10;         showHide(target, expanded);&#10;         el.setAttribute(&quot;aria-expanded&quot;, expanded.toString());&#10;         el.onchange = function () {&#10;            showHide(target, this.checked);&#10;            this.setAttribute(&quot;aria-expanded&quot;, this.checked.toString());&#10;         };&#10;      }&#10;   }&#10;   // Toggle checkbox when user presses space or enter on label&#10;   els = document.getElementsByClassName(&quot;lbl-toggle&quot;);&#10;   for (i = 0; i &lt; els.length; i++) {&#10;      var label = els[i];&#10;      label.onkeydown = function (e) {&#10;         if (e.which === 32 || e.which === 13) {&#10;            e.preventDefault();&#10;            this.click();&#10;         };&#10;      };&#10;   };&#10;}&#10;&#10;function clearParams() {&#10;   var areas = document.getElementById(&quot;coreArea&quot;);&#10;   areas[0].selected = true;&#10;   document.forms.dataSearchForm.creator.value = &quot;&quot;;&#10;   document.forms.dataSearchForm.project.value = &quot;&quot;;&#10;//    document.forms.dataSearchForm.identifier.value = &quot;&quot;;&#10;   document.forms.dataSearchForm.taxon.value = &quot;&quot;;&#10;   document.forms.dataSearchForm.geo.value = &quot;&quot;;&#10;   document.forms.dataSearchForm.data_year.checked = false;&#10;   document.forms.dataSearchForm.publish_year.checked = false;&#10;   document.forms.dataSearchForm.min_year.value = &quot;1900&quot;;&#10;   document.forms.dataSearchForm.max_year.value = &quot;2022&quot;;&#10;}&#10;&#10;// Selects the desired value in the Select control. If value is not in the&#10;// control, then first index is used. Returns actual selected value.&#10;function setSelectValue(elId, desiredValue) {&#10;   var el = document.getElementById(elId);&#10;   if (!el || !el.length) return null;&#10;   var result = el[0].value;&#10;   for (var i = 0; i &lt; el.length; i++) {&#10;      if (desiredValue === el[i].value) {&#10;         el[i].selected = true;&#10;         result = desiredValue;&#10;         break;&#10;      }&#10;   }&#10;   return result;&#10;}&#10;&#10;function isInteger(x) {&#10;   return (typeof x === 'number') &amp;&amp; (x % 1 === 0);&#10;}&#10;&#10;function makeAutocomplete(elementId, choices, minChars) {&#10;   if (!minChars) minChars = 2;&#10;   var autocomplete = new autoComplete({&#10;      selector: &quot;#&quot; + elementId,&#10;      minChars: minChars,&#10;      source: function (term, suggest) {&#10;         term = term.toLowerCase();&#10;         var suggestions = [];&#10;         for (var i = 0; i &lt; choices.length; i++)&#10;            if (~choices[i].toLowerCase().indexOf(term))&#10;               suggestions.push(choices[i]);&#10;         suggest(suggestions);&#10;      }&#10;   });&#10;   return autocomplete;&#10;}&#10;&#10;// --- Faceted Creator Dropdown Logic ---&#10;// Store all results for client-side filtering&#10;var ALL_PASTA_DOCS = [];&#10;&#10;function renderCreatorCheckboxes(creators, selected, creatorCounts) {&#10;  return creators.map(function(creator, i) {&#10;    var checked = selected.includes(creator) ? 'checked' : '';&#10;    var count = creatorCounts[creator] || 0;&#10;    return `&lt;label style=&quot;display:flex;align-items:center;padding:2px 12px 2px 8px;cursor:pointer;font-size:0.98em;&quot;&gt;&#10;      &lt;input type=&quot;checkbox&quot; class=&quot;creator-checkbox&quot; value=&quot;${creator.replace(/&amp;/g,'&amp;amp;').replace(/\&quot;/g,'&amp;quot;')}&quot; ${checked} style=&quot;margin-right:8px;&quot;&gt;${creator} &lt;span style='color:#888;font-size:0.95em;margin-left:6px;'&quot;&gt;(${count})&lt;/span&gt;&#10;    &lt;/label&gt;`;&#10;  }).join('');&#10;}&#10;&#10;function getSelectedCreators() {&#10;  var boxes = document.querySelectorAll('.creator-checkbox:checked');&#10;  return Array.from(boxes).map(function(box) { return box.value; });&#10;}&#10;&#10;function populateCreatorFacetOptions(docs, selected) {&#10;   var creatorSet = new Set();&#10;   var creatorCounts = {};&#10;   for (var i = 0; i &lt; docs.length; i++) {&#10;      var authorNodes = docs[i].getElementsByTagName(&quot;author&quot;);&#10;      for (var j = 0; j &lt; authorNodes.length; j++) {&#10;         var creator = authorNodes[j].innerHTML;&#10;         creatorSet.add(creator);&#10;         creatorCounts[creator] = (creatorCounts[creator] || 0) + 1;&#10;      }&#10;   }&#10;   var creatorDropdown = document.getElementById(&quot;creator-dropdown&quot;);&#10;   var creators = Array.from(creatorSet).sort();&#10;   creatorDropdown.innerHTML = renderCreatorCheckboxes(creators, selected || [], creatorCounts);&#10;}&#10;&#10;function filterDocsByCreators(docs, selectedCreators) {&#10;   if (!selectedCreators.length) return docs;&#10;   return docs.filter(function(doc) {&#10;      var authorNodes = doc.getElementsByTagName(&quot;author&quot;);&#10;      var authors = Array.from(authorNodes).map(function(n) { return n.innerHTML; });&#10;      return selectedCreators.some(function(sel) { return authors.includes(sel); });&#10;   });&#10;}&#10;&#10;// --- Faceted Keyword Dropdown Logic ---&#10;function renderKeywordCheckboxes(keywords, selected, keywordCounts) {&#10;  return keywords.map(function(keyword, i) {&#10;    var checked = selected.includes(keyword) ? 'checked' : '';&#10;    var count = keywordCounts[keyword] || 0;&#10;    return `&lt;label style=&quot;display:flex;align-items:center;padding:2px 12px 2px 8px;cursor:pointer;font-size:0.98em;&quot;&gt;&#10;      &lt;input type=&quot;checkbox&quot; class=&quot;keyword-checkbox&quot; value=&quot;${keyword.replace(/&amp;/g,'&amp;amp;').replace(/\&quot;/g,'&amp;quot;')}&quot; ${checked} style=&quot;margin-right:8px;&quot;&gt;${keyword} &lt;span style='color:#888;font-size:0.95em;margin-left:6px;'&quot;&gt;(${count})&lt;/span&gt;&#10;    &lt;/label&gt;`;&#10;  }).join('');&#10;}&#10;&#10;function getSelectedKeywords() {&#10;  var boxes = document.querySelectorAll('.keyword-checkbox:checked');&#10;  return Array.from(boxes).map(function(box) { return box.value; });&#10;}&#10;&#10;function populateKeywordFacetOptions(docs, selected) {&#10;   var keywordSet = new Set();&#10;   var keywordCounts = {};&#10;   for (var i = 0; i &lt; docs.length; i++) {&#10;      var keywordNodes = docs[i].getElementsByTagName(&quot;keyword&quot;);&#10;      for (var j = 0; j &lt; keywordNodes.length; j++) {&#10;         var keyword = keywordNodes[j].innerHTML;&#10;         keywordSet.add(keyword);&#10;         keywordCounts[keyword] = (keywordCounts[keyword] || 0) + 1;&#10;      }&#10;   }&#10;   var keywordDropdown = document.getElementById(&quot;keyword-dropdown&quot;);&#10;   var keywords = Array.from(keywordSet).sort();&#10;   keywordDropdown.innerHTML = renderKeywordCheckboxes(keywords, selected || [], keywordCounts);&#10;}&#10;&#10;function filterDocsByKeywords(docs, selectedKeywords) {&#10;   if (!selectedKeywords.length) return docs;&#10;   return docs.filter(function(doc) {&#10;      var keywordNodes = doc.getElementsByTagName(&quot;keyword&quot;);&#10;      var keywords = Array.from(keywordNodes).map(function(n) { return n.innerHTML; });&#10;      return selectedKeywords.some(function(sel) { return keywords.includes(sel); });&#10;   });&#10;}&#10;&#10;// Patch successCallback to store all docs and update creator and keyword facets&#10;var origSuccessCallback = successCallback;&#10;successCallback = function(headers, response) {&#10;   var parser = new DOMParser();&#10;   var xmlDoc = parser.parseFromString(response, &quot;text/xml&quot;);&#10;   var docs = Array.from(xmlDoc.getElementsByTagName(&quot;document&quot;));&#10;   ALL_PASTA_DOCS = docs;&#10;   var selectedCreators = getSelectedCreators();&#10;   var selectedKeywords = getSelectedKeywords();&#10;   populateCreatorFacetOptions(docs, selectedCreators);&#10;   populateKeywordFacetOptions(docs, selectedKeywords);&#10;   var filteredDocs = filterDocsByCreators(docs, selectedCreators);&#10;   filteredDocs = filterDocsByKeywords(filteredDocs, selectedKeywords);&#10;   if (PASTA_CONFIG[&quot;useCiteService&quot;]) {&#10;      buildCitationsFromCite(filteredDocs);&#10;   } else {&#10;      buildCitationsFromPasta(filteredDocs);&#10;   }&#10;   var count = filteredDocs.length;&#10;   setHtml(PASTA_CONFIG[&quot;csvElementId&quot;], '');&#10;   var currentStart = getParameterByName(&quot;start&quot;);&#10;   if (!currentStart) currentStart = 0; else currentStart = parseInt(currentStart);&#10;   var limit = parseInt(PASTA_CONFIG[&quot;limit&quot;]);&#10;   var showPages = parseInt(PASTA_CONFIG[&quot;showPages&quot;]);&#10;   var pageTopElementId = PASTA_CONFIG[&quot;pagesTopElementId&quot;];&#10;   var pageBotElementId = PASTA_CONFIG[&quot;pagesBotElementId&quot;];&#10;   showPageLinks(count, limit, showPages, currentStart, pageTopElementId);&#10;   showPageLinks(count, limit, showPages, currentStart, pageBotElementId);&#10;   var query = getParameterByName(&quot;q&quot;);&#10;   showResultCount(query, count, limit, currentStart, PASTA_CONFIG[&quot;countElementId&quot;]);&#10;}&#10;&#10;// --- Active Filters UI ---&#10;function renderActiveFilters(selectedCreators, selectedKeywords) {&#10;  var container = document.getElementById('active-filters');&#10;  if (!container) return;&#10;  var tags = [];&#10;  selectedCreators.forEach(function(creator) {&#10;    tags.push(`&lt;span class=&quot;filter-tag&quot;&gt;${creator} &lt;button class=&quot;remove-filter&quot; data-type=&quot;creator&quot; data-value=&quot;${encodeURIComponent(creator)}&quot; title=&quot;Remove filter&quot;&gt;&lt;/button&gt;&lt;/span&gt;`);&#10;  });&#10;  selectedKeywords.forEach(function(keyword) {&#10;    tags.push(`&lt;span class=&quot;filter-tag&quot;&gt;${keyword} &lt;button class=&quot;remove-filter&quot; data-type=&quot;keyword&quot; data-value=&quot;${encodeURIComponent(keyword)}&quot; title=&quot;Remove filter&quot;&gt;&lt;/button&gt;&lt;/span&gt;`);&#10;  });&#10;  var clearBtn = (tags.length &gt; 0) ? '&lt;button id=&quot;clear-all-filters&quot; class=&quot;clear-all-filters&quot;&gt;Clear all filters&lt;/button&gt;' : '';&#10;  container.innerHTML = tags.join(' ') + ' ' + clearBtn;&#10;}&#10;&#10;function uncheckFacet(type, value) {&#10;  var selector = type === 'creator' ? '.creator-checkbox' : '.keyword-checkbox';&#10;  var boxes = document.querySelectorAll(selector);&#10;  boxes.forEach(function(box) {&#10;    if (box.value === value) box.checked = false;&#10;  });&#10;}&#10;&#10;function clearAllFacets() {&#10;  var boxes = document.querySelectorAll('.creator-checkbox, .keyword-checkbox');&#10;  boxes.forEach(function(box) { box.checked = false; });&#10;}&#10;&#10;// Move processFacetChange to top-level scope so it can be called from anywhere&#10;function processFacetChange() {&#10;  var selectedCreators = getSelectedCreators();&#10;  var selectedKeywords = getSelectedKeywords();&#10;  var filteredDocs = filterDocsByCreators(ALL_PASTA_DOCS, selectedCreators || []);&#10;  filteredDocs = filterDocsByKeywords(filteredDocs, selectedKeywords || []);&#10;  populateCreatorFacetOptions(filteredDocs, selectedCreators);&#10;  populateKeywordFacetOptions(filteredDocs, selectedKeywords);&#10;  renderActiveFilters(selectedCreators, selectedKeywords);&#10;  if (PASTA_CONFIG[&quot;useCiteService&quot;]) {&#10;    buildCitationsFromCite(filteredDocs);&#10;  } else {&#10;    buildCitationsFromPasta(filteredDocs);&#10;  }&#10;  var count = filteredDocs.length;&#10;  setHtml(PASTA_CONFIG[&quot;csvElementId&quot;], '');&#10;  var currentStart = 0;&#10;  var limit = parseInt(PASTA_CONFIG[&quot;limit&quot;]);&#10;  var showPages = parseInt(PASTA_CONFIG[&quot;showPages&quot;]);&#10;  var pageTopElementId = PASTA_CONFIG[&quot;pagesTopElementId&quot;];&#10;  var pageBotElementId = PASTA_CONFIG[&quot;pagesBotElementId&quot;];&#10;  showPageLinks(count, limit, showPages, currentStart, pageTopElementId);&#10;  showPageLinks(count, limit, showPages, currentStart, pageBotElementId);&#10;  var query = getParameterByName(&quot;q&quot;);&#10;  showResultCount(query, count, limit, currentStart, PASTA_CONFIG[&quot;countElementId&quot;]);&#10;}&#10;&#10;document.addEventListener(&quot;DOMContentLoaded&quot;, function() {&#10;   // Fetch initial dataset from PASTA server and initialize facets/results&#10;   var url = PASTA_CONFIG.server + &quot;fl=title,pubdate,doi,packageid,author,abstract,keyword&amp;defType=edismax&quot; + PASTA_CONFIG.filter + &quot;&amp;q=*&amp;rows=1000&quot;;&#10;   showLoading(true);&#10;   makeCorsRequest(url, null, function(headers, response) {&#10;      var parser = new DOMParser();&#10;      var xmlDoc = parser.parseFromString(response, &quot;text/xml&quot;);&#10;      var docs = Array.from(xmlDoc.getElementsByTagName(&quot;document&quot;));&#10;      ALL_PASTA_DOCS = docs;&#10;      populateCreatorFacetOptions(docs, []);&#10;      populateKeywordFacetOptions(docs, []);&#10;      // Render all results initially&#10;      if (PASTA_CONFIG[&quot;useCiteService&quot;]) {&#10;         buildCitationsFromCite(docs);&#10;      } else {&#10;         buildCitationsFromPasta(docs);&#10;      }&#10;      showLoading(false);&#10;   }, errorCallback);&#10;&#10;   var creatorToggleBtn = document.getElementById(&quot;creator-toggle-btn&quot;);&#10;   var creatorDropdown = document.getElementById(&quot;creator-dropdown&quot;);&#10;   var creatorArrow = document.getElementById(&quot;creator-arrow&quot;);&#10;   var expanded = false;&#10;   if (creatorToggleBtn &amp;&amp; creatorDropdown &amp;&amp; creatorArrow) {&#10;      creatorToggleBtn.addEventListener(&quot;click&quot;, function(e) {&#10;         e.preventDefault();&#10;         expanded = !expanded;&#10;         if (expanded) {&#10;            creatorDropdown.style.display = &quot;block&quot;;&#10;            creatorArrow.innerHTML = &quot;&amp;#x25B2;&quot;;&#10;            creatorDropdown.focus();&#10;         } else {&#10;            creatorDropdown.style.display = &quot;none&quot;;&#10;            creatorArrow.innerHTML = &quot;&amp;#x25BC;&quot;;&#10;         }&#10;      });&#10;      // Optional: collapse when focus is lost&#10;      creatorDropdown.addEventListener(&quot;blur&quot;, function(e) {&#10;         setTimeout(function() {&#10;            // Only collapse if focus is not on a child element (e.g., a checkbox)&#10;            if (!creatorDropdown.contains(document.activeElement)) {&#10;               creatorDropdown.style.display = &quot;none&quot;;&#10;               creatorArrow.innerHTML = &quot;&amp;#x25BC;&quot;;&#10;               expanded = false;&#10;            }&#10;         }, 150);&#10;      });&#10;      // Debounce utility&#10;      function debounce(func, wait) {&#10;        var timeout;&#10;        return function() {&#10;          var context = this, args = arguments;&#10;          clearTimeout(timeout);&#10;          timeout = setTimeout(function() {&#10;            func.apply(context, args);&#10;          }, wait);&#10;        };&#10;      }&#10;      // Unified handler for facet (creator/keyword) changes&#10;      var processFacetChange = debounce(function() {&#10;        var selectedCreators = getSelectedCreators();&#10;        var selectedKeywords = getSelectedKeywords();&#10;        // Apply both filters to get filteredDocs&#10;        var filteredDocs = filterDocsByCreators(ALL_PASTA_DOCS, selectedCreators || []);&#10;        filteredDocs = filterDocsByKeywords(filteredDocs, selectedKeywords || []);&#10;        // Dynamically update facet options based on filteredDocs&#10;        populateCreatorFacetOptions(filteredDocs, selectedCreators);&#10;        populateKeywordFacetOptions(filteredDocs, selectedKeywords);&#10;        // Render active filters UI&#10;        renderActiveFilters(selectedCreators, selectedKeywords);&#10;        // Render filtered results&#10;        if (PASTA_CONFIG[&quot;useCiteService&quot;]) {&#10;          buildCitationsFromCite(filteredDocs);&#10;        } else {&#10;          buildCitationsFromPasta(filteredDocs);&#10;        }&#10;        var count = filteredDocs.length;&#10;        setHtml(PASTA_CONFIG[&quot;csvElementId&quot;], '');&#10;        var currentStart = 0;&#10;        var limit = parseInt(PASTA_CONFIG[&quot;limit&quot;]);&#10;        var showPages = parseInt(PASTA_CONFIG[&quot;showPages&quot;]);&#10;        var pageTopElementId = PASTA_CONFIG[&quot;pagesTopElementId&quot;];&#10;        var pageBotElementId = PASTA_CONFIG[&quot;pagesBotElementId&quot;];&#10;        showPageLinks(count, limit, showPages, currentStart, pageTopElementId);&#10;        showPageLinks(count, limit, showPages, currentStart, pageBotElementId);&#10;        var query = getParameterByName(&quot;q&quot;);&#10;        showResultCount(query, count, limit, currentStart, PASTA_CONFIG[&quot;countElementId&quot;]);&#10;      }, 200);&#10;      // Listen for creator checkbox changes&#10;      creatorDropdown.addEventListener(&quot;change&quot;, function(e) {&#10;        if (e.target.classList.contains('creator-checkbox')) {&#10;          processFacetChange();&#10;        }&#10;      });&#10;   }&#10;   // Keyword dropdown logic&#10;   var keywordToggleBtn = document.getElementById(&quot;keyword-toggle-btn&quot;);&#10;   var keywordDropdown = document.getElementById(&quot;keyword-dropdown&quot;);&#10;   var keywordArrow = document.getElementById(&quot;keyword-arrow&quot;);&#10;   var keywordExpanded = false;&#10;   if (keywordToggleBtn &amp;&amp; keywordDropdown &amp;&amp; keywordArrow) {&#10;      keywordToggleBtn.addEventListener(&quot;click&quot;, function(e) {&#10;         e.preventDefault();&#10;         keywordExpanded = !keywordExpanded;&#10;         if (keywordExpanded) {&#10;            keywordDropdown.style.display = &quot;block&quot;;&#10;            keywordArrow.innerHTML = &quot;\u25B2&quot;; // Remove the semicolon&#10;            keywordDropdown.focus();&#10;         } else {&#10;            keywordDropdown.style.display = &quot;none&quot;;&#10;            keywordArrow.innerHTML = &quot;\u25BC&quot;; // Remove the semicolon&#10;         }&#10;      });&#10;      keywordDropdown.addEventListener(&quot;blur&quot;, function(e) {&#10;         setTimeout(function() {&#10;            if (!keywordDropdown.contains(document.activeElement)) {&#10;               keywordDropdown.style.display = &quot;none&quot;;&#10;               keywordArrow.innerHTML = &quot;\u25BC&quot;; // Remove the semicolon&#10;               keywordExpanded = false;&#10;            }&#10;         }, 150);&#10;      });&#10;      // Listen for keyword checkbox changes&#10;      keywordDropdown.addEventListener(&quot;change&quot;, function(e) {&#10;        if (e.target.classList.contains('keyword-checkbox')) {&#10;          processFacetChange();&#10;        }&#10;      });&#10;   }&#10;&#10;   // Listen for remove filter clicks and clear all&#10;   document.body.addEventListener('click', function(e) {&#10;     if (e.target.classList.contains('remove-filter')) {&#10;       e.preventDefault();&#10;       e.stopPropagation();&#10;       var type = e.target.getAttribute('data-type');&#10;       var value = decodeURIComponent(e.target.getAttribute('data-value'));&#10;       uncheckFacet(type, value);&#10;       processFacetChange();&#10;     }&#10;     if (e.target.id === 'clear-all-filters') {&#10;       e.preventDefault();&#10;       clearAllFacets();&#10;       processFacetChange();&#10;     }&#10;   });&#10;});&#10;&#10;// When the window loads, read query parameters and perform search&#10;window.onload = function () {&#10;   function initApp(expanded) {&#10;      initCollapsible(expanded);&#10;&#10;      var sortControl = document.getElementById(&quot;visibleSort&quot;);&#10;      if (sortControl) {&#10;         sortControl.onchange = function () {&#10;            var hiddenSortControl = document.getElementById(&quot;sort&quot;);&#10;            hiddenSortControl.value = this.options[this.selectedIndex].value;&#10;            var form = document.getElementById(&quot;dataSearchForm&quot;);&#10;            form.submit();&#10;         };&#10;      }&#10;   }&#10;&#10;   var query = getParameterByName(&quot;q&quot;);&#10;   var coreAreaParam = getParameterByName(&quot;coreArea&quot;);&#10;   var creator = getParameterByName(&quot;creator&quot;);&#10;   var project = getParameterByName(&quot;project&quot;);&#10;   var sYear = parseInt(getParameterByName(&quot;s&quot;));&#10;   var eYear = parseInt(getParameterByName(&quot;e&quot;));&#10;   var datayear = getParameterByName(&quot;datayear&quot;) === &quot;y&quot;;&#10;   var pubyear = getParameterByName(&quot;pubyear&quot;) === &quot;y&quot;;&#10;   var pkgId = getParameterByName(&quot;id&quot;);&#10;   var taxon = getParameterByName(&quot;taxon&quot;);&#10;   var geo = getParameterByName(&quot;geo&quot;);&#10;   var expanded = Boolean(getParameterByName(&quot;expanded&quot;));&#10;   var pageStart = getParameterByName(&quot;start&quot;);&#10;   var sortParam = getParameterByName(&quot;sort&quot;);&#10;   if (!pageStart) pageStart = 0;&#10;&#10;   initApp(expanded);&#10;&#10;   if (!query) query = &quot;*&quot;; // default for empty query&#10;   QUERY_URL = makeQueryUrlBase(query, coreArea, creator, sYear, eYear,&#10;      datayear, pubyear, pkgId, taxon, geo, project, sortParam)&#10;   searchPasta(PASTA_CONFIG[&quot;limit&quot;], pageStart);&#10;&#10;   if (&quot;PASTA_LOOKUP&quot; in window) {&#10;      makeAutocomplete(&quot;creator&quot;, PASTA_LOOKUP[&quot;author&quot;]);&#10;      makeAutocomplete(&quot;project&quot;, PASTA_LOOKUP[&quot;projectTitle&quot;].concat(PASTA_LOOKUP[&quot;relatedProjectTitle&quot;]));&#10;      makeAutocomplete(&quot;taxon&quot;, PASTA_LOOKUP[&quot;taxonomic&quot;]);&#10;   }&#10;};" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/public/search.css">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/public/search.css" />
              <option name="originalContent" value=".loading {&#10;&#9;display: none;&#10;    width: 100px;&#10;    height: 100px;&#10;&#10;    position: absolute;&#10;    top:0;&#10;    bottom: 0;&#10;    left: 0;&#10;    right: 0;&#10;&#10;    margin: auto;&#10;}&#10;&#10;.dataset-title a {&#10;    font-size: 1.2em;&#10;    text-decoration: none;&#10;}&#10;&#10;.dataset-title a:hover {&#10;    text-decoration: underline;&#10;}&#10;&#10;.dataset-author {&#10;    color: #808080;&#10;}&#10;&#10;.search-input {&#10;    width: 250px;&#10;    margin-bottom: 10px;&#10;}&#10;&#10;.resultCount {&#10;    color: #808080;&#10;}&#10;&#10;.result-query {&#10;    font-weight: bold;&#10;}&#10;&#10;.pagination {&#10;&#9;margin: 16px 8px 16px 8px;&#10;}&#10;.pagination a {&#10;&#9;color: black;&#10;&#9;padding: 8px 16px;&#10;&#9;text-decoration: none;&#10;}&#10;.pagination a.active {&#10;&#9;background-color: #0d3760;&#10;&#9;color: white;&#10;}&#10;.pagination a:hover:not(.active) {&#10;&#9;background-color: #ddd;&#10;}&#10;&#10;/* collapsible */&#10;input[type='checkbox'].collapse-toggle {&#10;   display: none;&#10;}&#10;&#10;.lbl-toggle {&#10;   cursor: pointer;&#10;   transition: all 0.25s ease-out;&#10;}&#10; &#10;.lbl-toggle::before {&#10;   content: ' ';&#10;   display: inline-block;&#10; &#10;   border-top: 5px solid transparent;&#10;   border-bottom: 5px solid transparent;&#10;   border-left: 5px solid currentColor;&#10; &#10;   vertical-align: middle;&#10;   margin-right: .1rem;&#10;   transform: translateY(-2px);&#10; &#10;   transition: transform .2s ease-out;&#10;}&#10;&#10;.collapse-toggle:checked + .lbl-toggle::before {&#10;   transform: rotate(90deg) translateX(-3px);&#10;}&#10; &#10;.collapse-toggle:checked + .lbl-toggle {&#10;   border-bottom-right-radius: 0;&#10;   border-bottom-left-radius: 0;&#10;}&#10;&#10;.collapsible {&#10;   padding: 0 11px;&#10;   max-height: 0;&#10;   overflow: hidden;&#10;   transition: max-height .25s ease-in-out;&#10;}&#10;&#10;.yearbox {&#10;   width: 50px;&#10;}&#10;&#10;.yeardiv {&#10;   display: inline-block;&#10;   margin-left: 10px;&#10;   margin-bottom: 5px;&#10;}&#10;&#10;.input-block {&#10;   border-bottom: 1px dashed gray;&#10;   margin-bottom: 5px;&#10;   max-width: 256px;&#10;   position: relative;&#10;}&#10;&#10;#creator {&#10;  min-width: unset;&#10;  max-width: unset;&#10;  width: 100%;&#10;  position: static;&#10;  background: #fff;&#10;  box-shadow: none;&#10;  border: 1px solid #ccc;&#10;  display: block;&#10;  margin-left: 0;&#10;  margin-bottom: 10px;&#10;  font-size: 1em;&#10;  padding: 4px 8px;&#10;}&#10;#creator:focus {&#10;  outline: 2px solid #007bff;&#10;}&#10;#creator[multiple] {&#10;  height: 120px;&#10;  overflow-y: auto;&#10;  display: block;&#10;  margin-left: 0;&#10;}&#10;#creator.show {&#10;  display: block !important;&#10;}&#10;#creator-expand-btn {&#10;  /* already styled inline, but can add more here if needed */&#10;}&#10;#creator-expand-btn.active #creator-expand-icon {&#10;  transform: rotate(90deg);&#10;}&#10;@media (max-width: 600px) {&#10;  #creator {&#10;    min-width: 200px;&#10;    margin-left: 0;&#10;  }&#10;}&#10;&#10;.filter-tag {&#10;  display: inline-block;&#10;  background: #e0e7ef;&#10;  color: #234;&#10;  border-radius: 16px;&#10;  padding: 3px 10px 3px 8px;&#10;  margin: 0 6px 6px 0;&#10;  font-size: 0.98em;&#10;  line-height: 1.7;&#10;  border: 1px solid #b5c6d6;&#10;  box-shadow: 0 1px 2px rgba(0,0,0,0.04);&#10;}&#10;.filter-tag button.remove-filter {&#10;  background: none;&#10;  border: none;&#10;  color: #888;&#10;  font-size: 1.1em;&#10;  margin-left: 4px;&#10;  cursor: pointer;&#10;  outline: none;&#10;  padding: 0;&#10;}&#10;.filter-tag button.remove-filter:hover {&#10;  color: #c00;&#10;}&#10;#clear-all-filters {&#10;  background: #f5f5f5;&#10;  border: 1px solid #b5c6d6;&#10;  color: #234;&#10;  border-radius: 16px;&#10;  padding: 3px 14px;&#10;  margin-left: 8px;&#10;  font-size: 0.98em;&#10;  cursor: pointer;&#10;  transition: background 0.15s;&#10;}&#10;#clear-all-filters:hover {&#10;  background: #e0e7ef;&#10;  color: #c00;&#10;}&#10;" />
              <option name="updatedContent" value=".loading {&#10;&#9;display: none;&#10;    width: 100px;&#10;    height: 100px;&#10;&#10;    position: absolute;&#10;    top:0;&#10;    bottom: 0;&#10;    left: 0;&#10;    right: 0;&#10;&#10;    margin: auto;&#10;}&#10;&#10;.dataset-title a {&#10;    font-size: 1.2em;&#10;    text-decoration: none;&#10;}&#10;&#10;.dataset-title a:hover {&#10;    text-decoration: underline;&#10;}&#10;&#10;.dataset-author {&#10;    color: #808080;&#10;}&#10;&#10;.search-input {&#10;    width: 250px;&#10;    margin-bottom: 10px;&#10;}&#10;&#10;.resultCount {&#10;    color: #808080;&#10;}&#10;&#10;.result-query {&#10;    font-weight: bold;&#10;}&#10;&#10;.pagination {&#10;&#9;margin: 16px 8px 16px 8px;&#10;}&#10;.pagination a {&#10;&#9;color: black;&#10;&#9;padding: 8px 16px;&#10;&#9;text-decoration: none;&#10;}&#10;.pagination a.active {&#10;&#9;background-color: #0d3760;&#10;&#9;color: white;&#10;}&#10;.pagination a:hover:not(.active) {&#10;&#9;background-color: #ddd;&#10;}&#10;&#10;/* collapsible */&#10;input[type='checkbox'].collapse-toggle {&#10;   display: none;&#10;}&#10;&#10;.lbl-toggle {&#10;   cursor: pointer;&#10;   transition: all 0.25s ease-out;&#10;}&#10; &#10;.lbl-toggle::before {&#10;   content: ' ';&#10;   display: inline-block;&#10; &#10;   border-top: 5px solid transparent;&#10;   border-bottom: 5px solid transparent;&#10;   border-left: 5px solid currentColor;&#10; &#10;   vertical-align: middle;&#10;   margin-right: .1rem;&#10;   transform: translateY(-2px);&#10; &#10;   transition: transform .2s ease-out;&#10;}&#10;&#10;.collapse-toggle:checked + .lbl-toggle::before {&#10;   transform: rotate(90deg) translateX(-3px);&#10;}&#10; &#10;.collapse-toggle:checked + .lbl-toggle {&#10;   border-bottom-right-radius: 0;&#10;   border-bottom-left-radius: 0;&#10;}&#10;&#10;.collapsible {&#10;   padding: 0 11px;&#10;   max-height: 0;&#10;   overflow: hidden;&#10;   transition: max-height .25s ease-in-out;&#10;}&#10;&#10;.yearbox {&#10;   width: 50px;&#10;}&#10;&#10;.yeardiv {&#10;   display: inline-block;&#10;   margin-left: 10px;&#10;   margin-bottom: 5px;&#10;}&#10;&#10;.input-block {&#10;   border-bottom: 1px dashed gray;&#10;   margin-bottom: 5px;&#10;   max-width: 256px;&#10;   position: relative;&#10;}&#10;&#10;#creator {&#10;  min-width: unset;&#10;  max-width: unset;&#10;  width: 100%;&#10;  position: static;&#10;  background: #fff;&#10;  box-shadow: none;&#10;  border: 1px solid #ccc;&#10;  display: block;&#10;  margin-left: 0;&#10;  margin-bottom: 10px;&#10;  font-size: 1em;&#10;  padding: 4px 8px;&#10;}&#10;#creator:focus {&#10;  outline: 2px solid #007bff;&#10;}&#10;#creator[multiple] {&#10;  height: 120px;&#10;  overflow-y: auto;&#10;  display: block;&#10;  margin-left: 0;&#10;}&#10;#creator.show {&#10;  display: block !important;&#10;}&#10;#creator-expand-btn {&#10;  /* already styled inline, but can add more here if needed */&#10;}&#10;#creator-expand-btn.active #creator-expand-icon {&#10;  transform: rotate(90deg);&#10;}&#10;@media (max-width: 600px) {&#10;  #creator {&#10;    min-width: 200px;&#10;    margin-left: 0;&#10;  }&#10;}&#10;&#10;.filter-tag {&#10;  display: inline-block;&#10;  background: #e0e7ef;&#10;  color: #234;&#10;  border-radius: 16px;&#10;  padding: 3px 10px 3px 8px;&#10;  margin: 0 6px 6px 0;&#10;  font-size: 0.98em;&#10;  line-height: 1.7;&#10;  border: 1px solid #b5c6d6;&#10;  box-shadow: 0 1px 2px rgba(0,0,0,0.04);&#10;}&#10;.filter-tag button.remove-filter {&#10;  background: none;&#10;  border: none;&#10;  color: #888;&#10;  font-size: 1.1em;&#10;  margin-left: 4px;&#10;  cursor: pointer;&#10;  outline: none;&#10;  padding: 0;&#10;}&#10;.filter-tag button.remove-filter:hover {&#10;  color: #c00;&#10;}&#10;#clear-all-filters {&#10;  background: #f5f5f5;&#10;  border: 1px solid #b5c6d6;&#10;  color: #234;&#10;  border-radius: 16px;&#10;  padding: 3px 14px;&#10;  margin-left: 8px;&#10;  font-size: 0.98em;&#10;  cursor: pointer;&#10;  transition: background 0.15s;&#10;}&#10;#clear-all-filters:hover {&#10;  background: #e0e7ef;&#10;  color: #c00;&#10;}&#10;#active-filters {&#10;  min-height: 36px;&#10;  display: flex;&#10;  align-items: flex-start;&#10;  flex-wrap: wrap;&#10;  margin-bottom: 1em;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>